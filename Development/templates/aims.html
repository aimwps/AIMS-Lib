{% if user.is_authenticated %}

    {% for cat in aims_by_cat %}
      {% if cat.1 %}

          <div class="accordion" id="AimsAccordion_{{ cat.0 }}">
            {% for aim, levers in cat.1.items %}
              <div class="accordion-item">
                <h2 class="accordion-header" id="heading_{{ forloop.counter0 }}_{{ forloop.parentloop.counter0 }}">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_{{ forloop.counter0 }}_{{ forloop.parentloop.counter0 }}" aria-expanded="false" aria-controls="collapse_{{ forloop.counter0 }}_{{ forloop.parentloop.counter0 }}">
                    <p><strong>{{cat.0}}</strong> {{ aim.title }}</p>
                  </button>
                </h2>
                <div id="collapse_{{ forloop.counter0 }}_{{ forloop.parentloop.counter0 }}" class="accordion-collapse collapse" aria-labelledby="heading_{{ forloop.counter0 }}_{{ forloop.parentloop.counter0 }}">
                  <div class="accordion-body">

                    <div class="row">
                      <h5> My reasons why <a type="button" class="text-primary" data-bs-toggle="modal" data-bs-target="#aim_setting_modal_{{ forloop.counter0 }}_{{ forloop.parentloop.counter0 }}">
                      <i class="fas fa-map-pin"></i></a>
                      </h5>
                    </div>


                    <!-- Modal -->
                    <div class="modal fade" id="aim_setting_modal_{{ forloop.counter0 }}_{{ forloop.parentloop.counter0 }}" tabindex="-1" aria-labelledby="aim_setting_modal_{{ forloop.counter0 }}_{{ forloop.parentloop.counter0 }}Label" aria-hidden="true">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h4 class="modal-title" id="aim_setting_modal_{{ forloop.counter0 }}_{{ forloop.parentloop.counter0 }}Label">Aim Settings</h4>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body">
                            {{ aim.title }}

                          </div>
                          <div class="modal-footer">
                            <a href='{% url "lever-new" aim.id %}' class="btn btn-primary"><i class="far fa-plus"></i></a>
                            <a href='{% url "edit-aim" aim.id %}' class="btn btn-primary"><i class="far fa-edit"></i></a>

                            <form action="." method="POST">
                              {% csrf_token %}
                              <button name="delete_aim" value="{{aim.id}}" class="btn btn-secondary">
                                <i class="far fa-trash-alt"></i></button>
                            </form>





                          </div>
                        </div>
                      </div>
                    </div>

                     <p>{{ aim.why }}</p>
                    {% for lever, trackers in levers.items %}

                      <div class="row">
                          <h5 data-bs-toggle="tooltip" title="Behaviour Settings">
                            <a type="button" class="text-primary" data-bs-toggle="modal" data-bs-target="#behaviour_setting_modal_{{ forloop.counter0 }}_{{ forloop.parentloop.counter0 }}">
                            <i class="fas fa-brain"></i>
                          </a> {{ lever.description }}
                      </div>
                      <!-- Modal -->
                      <div class="modal fade" id="behaviour_setting_modal_{{ forloop.counter0 }}_{{ forloop.parentloop.counter0 }}" tabindex="-1" aria-labelledby="behaviour_setting_modal_{{ forloop.counter0 }}_{{ forloop.parentloop.counter0 }}Label" aria-hidden="true">
                        <div class="modal-dialog">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h5 class="modal-title" id="behaviour_setting_modal_{{ forloop.counter0 }}_{{ forloop.parentloop.counter0 }}Label">Behaviour settings</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                              {{ lever.description }}
                            </div>
                            <div class="modal-footer">
                              <a href='{% url "tracker-select" lever.id %}' class="btn btn-primary"><i class="far fa-plus"></i></a>
                              <a href='{% url "edit-lever" lever.id %}' class="btn btn-primary"><i class="far fa-edit"></i></a>

                              <form action="." method="POST">
                                {% csrf_token %}
                                <button name="delete_behaviour" value="{{lever.id}}" class="btn btn-secondary">
                                  <i class="far fa-trash-alt"></i></button>
                              </form>
                            </div>
                          </div>
                        </div>
                      </div>
                      {% for tracker in trackers %}
                      <div class="row justify-content-end">
                        <!-- Button trigger modal -->
                        <p><small>Starting from {{ tracker.start_date}} a '{{ tracker.get_pretty_tclass }}' goal is being tracked</small><br>{{ tracker.get_tsentence }} <a class="" type="button" data-bs-toggle="modal" data-bs-target="#tracker_setting_modal_{{ forloop.counter0 }}_{{ forloop.parentloop.counter0 }}">
                          <i class="fas fa-shoe-prints text-primary"></i></a></p>
                        </div>

                        <!-- Modal -->
                        <div class="modal fade" id="tracker_setting_modal_{{ forloop.counter0 }}_{{ forloop.parentloop.counter0 }}" tabindex="-1" aria-labelledby="tracker_setting_modal_{{ forloop.counter0 }}_{{ forloop.parentloop.counter0 }}Label" aria-hidden="true">
                          <div class="modal-dialog">
                            <div class="modal-content">
                              <div class="modal-header">
                                <h5 class="modal-title" id="tracker_setting_modal_{{ forloop.counter0 }}_{{ forloop.parentloop.counter0 }}Label">Tracker settings</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                              </div>
                              <div class="modal-body">
                                <ul>
                                  <li> {{ tracker.get_tclass }} </li>
                                  <li> {{ tracker.get_tsentence }} </li>
                                  <li> {{ tracker.get_tquestion }} </li>
                                </ul>

                              </div>
                              <div class="modal-footer">
                                <a href='{% url "log-any-tracker" tracker.get_tclass tracker.id %}' class="btn btn-primary"><i class="far fa-plus"></i></a>

                                {% if tracker.get_tclass == "TrackerMinAim" %}
                                  <a href='{% url "edit-min-tracker" tracker.id %}' class="btn btn-primary"><i class="far fa-edit"></i></a>
                                {% endif %}

                                {% if tracker.get_tclass == "TrackerBoolean" %}
                                  <a href='{% url "edit-bool-tracker" tracker.id %}' class="btn btn-primary"><i class="far fa-edit"></i></a>
                                {% endif %}

                                <form action="." method="POST">
                                  {% csrf_token %}
                                  <input type="hidden" value="{{ tracker.get_tclass }}" name="delete_tclass">
                                  <input type="hidden" value="{{ tracker.id }}" name="delete_tid">
                                  <button name="delete_tracker" value="{{tracker.id}}" class="btn btn-secondary">
                                    <i class="far fa-trash-alt"></i></button>
                                </form>
                              </div>
                            </div>
                          </div>
                        </div>

                      {% endfor %}
                    {% endfor %}
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% endif %}
    {% endfor %}

{% endif %}
